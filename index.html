<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Happy Birthday!</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    /* REMOVED: height: 100%; to allow content to dictate page height */
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
    /* Default background for Page 1 & 2 */
    background: linear-gradient(160deg, #ff9966 0%, #ff5e62 100%);
    transition: background 1s ease;
}

  /* --- Page 1: Intro Styles --- */
  #intro {
    /* CHANGED: min-height ensures it covers the screen but allows scrolling */
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
    position: relative; 
    /* CHANGED: 'visible' to allow scrolling */
    overflow: visible; 
    padding: 20px 0; /* Add padding for content near top/bottom */
  }

  #intro-content {
    max-width: 80%;
    background: rgba(0, 0, 0, 0.2);
    padding: 30px;
    border-radius: 20px;
    backdrop-filter: blur(5px);
    margin-bottom: 40px;
    z-index: 10; 
  }

  #intro h2 {
    font-size: 2.2em;
    margin-bottom: 20px;
    text-shadow: 0 0 10px #ffafcc;
  }

  #intro p {
    font-size: 1.1em;
    line-height: 1.6;
    margin: 10px 0;
  }

  /* Button Styles */
  #intro button {
    background: linear-gradient(90deg, #fa709a 0%, #fee140 100%); 
    border: none;
    padding: 20px 40px;
    font-size: 1.5em;
    color: white;
    border-radius: 2rem; 
    cursor: pointer;
    box-shadow: 0 0 30px 0 #fa709a80; 
    transition: box-shadow 0.3s, transform 0.2s, filter 0.3s; 
    animation: bounce 1s infinite alternate; 
    outline: none; 
    position: relative;
    z-index: 10;
  }

  #intro button:hover {
    filter: brightness(1.13); 
    box-shadow: 0 0 50px 10px #fee140bb, 0 0 30px 2px #fa709a88; 
    transform: scale(1.08) rotate(-2deg); 
    transition: all 0.2s; 
    z-index: 100; 
  }

  @keyframes bounce {
    0% { transform: translateY(0);}
    100% { transform: translateY(-8px);}
  }

  /* Confetti Styles (Kept for button click) */
  .confetti {
    position: absolute;
    left: 50%; top: 50%;
    pointer-events: none;
    width: 0; height: 0;
    z-index: 2;
  }
  .confetti-piece {
    position: absolute;
    width: 10px; height: 18px;
    border-radius: 4px;
    background: linear-gradient(to bottom, #fee140, #fa709a);
    opacity: 0.9;
    animation: confetti-fall 0.7s linear;
  }
  @keyframes confetti-fall {
    to {
      transform: translate(var(--x), var(--y)) rotate(200deg);
      opacity: 0;
    }
  }

  /* --- Heart Falling Animation (Used on Page 1) --- */
  .intro-heart {
    position: absolute;
    width: 15px;
    height: 15px;
    background: #ff4d94; /* Lighter pink for intro */
    transform: rotate(-45deg);
    z-index: 1;
    animation: heart-fall-intro 12s linear infinite;
    opacity: 0.7;
  }

  .intro-heart::before, .intro-heart::after {
    content: "";
    position: absolute;
    width: 15px;
    height: 15px;
    background: #ff4d94;
    border-radius: 50%;
  }

  .intro-heart::before {
    top: -7.5px;
    left: 0;
  }

  .intro-heart::after {
    top: 0;
    left: 7.5px;
  }

  @keyframes heart-fall-intro {
    0% { top: -10%; opacity: 0; transform: translateX(0) rotate(-45deg); }
    10% { opacity: 1; }
    50% { transform: translateX(30px) rotate(-45deg); }
    100% { top: 110%; opacity: 0.2; transform: translateX(-10px) rotate(-45deg); }
  }


  /* --- Page 2: Carousel/Music Styles --- */
  #mainContent {
    display: none;
    perspective: 1000px;
    text-align: center;
    padding: 20px;
    /* CHANGED: min-height allows content to dictate page height */
    min-height: 100vh;
  }

  h1.animated-text {
    font-size: 3em;
    margin: 20px;
    letter-spacing: 2px;
    animation: fadeInDown 2s ease forwards;
    opacity: 0;
  }

  @keyframes fadeInDown {
    0% { opacity: 0; transform: translateY(-50px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  .timer-controls {
    margin: 20px auto;
    padding: 15px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    max-width: 400px;
    font-size: 1.2em;
    text-shadow: 0 0 5px rgba(0,0,0,0.5);
  }

  .carousel {
    width: 600px;
    height: 400px;
    margin: 40px auto;
    position: relative;
    transform-style: preserve-3d;
    animation: rotateCarousel 35s linear infinite;
  }
  
  @media (max-width: 768px) {
    .carousel {
      width: 90vw;
      height: 300px;
      margin: 20px auto;
      transform: scale(0.7); /* Scale down for better mobile fit */
      transform-origin: center center;
    }
  }

  @keyframes rotateCarousel {
    from { transform: rotateY(0deg);}
    to { transform: rotateY(360deg);}
  }

  .photo {
    position: absolute;
    width: 200px;
    height: 280px;
    box-shadow: 0 15px 30px rgba(0,0,0,0.5);
    border-radius: 15px;
    background-size: cover;
    background-position: center;
    transition: transform 0.3s ease;
    cursor: pointer;
    border: 3px solid white;
  }

  .photo:hover {
    transform: scale(1.2) translateZ(50px);
    box-shadow: 0 25px 50px rgba(0,0,0,0.7);
    z-index: 10;
  }

  /* Position photos in 3D space */
  .photo:nth-child(1) { transform: rotateY(0deg) translateZ(400px); }
  .photo:nth-child(2) { transform: rotateY(45deg) translateZ(400px); }
  .photo:nth-child(3) { transform: rotateY(90deg) translateZ(400px); }
  .photo:nth-child(4) { transform: rotateY(135deg) translateZ(400px); }
  .photo:nth-child(5) { transform: rotateY(180deg) translateZ(400px); }
  .photo:nth-child(6) { transform: rotateY(225deg) translateZ(400px); }
  .photo:nth-child(7) { transform: rotateY(270deg) translateZ(400px); }
  .photo:nth-child(8) { transform: rotateY(315deg) translateZ(400px); }
  .photo:nth-child(9) { transform: rotateY(315deg) translateZ(400px); }
  .photo:nth-child(10) { transform: rotateY(315deg) translateZ(400px); }

  /* --- Page 3: Final Wish Styles (Hidden until music ends) --- */
  #finalWish {
    display: none;
    /* CHANGED: min-height ensures it covers the screen but allows scrolling */
    min-height: 100vh;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
    /* Love theme background - using a deep red/pink/gold gradient */
    background: linear-gradient(160deg, #ff077a 0%, #ff4d94 50%, #f4c4f3 100%);
    position: relative;
    /* CHANGED: 'visible' to allow scrolling */
    overflow: visible;
    padding: 40px 0; /* Important: Add vertical padding to allow content to breathe */
  }

  .wish-box {
    background: rgba(0, 0, 0, 0.4);
    padding: 50px;
    border-radius: 25px;
    max-width: 90%;
    box-shadow: 0 0 50px rgba(255, 0, 119, 0.9);
    z-index: 5; /* Above hearts */
    display: flex; /* Enable flexbox for content layout */
    flex-direction: column; /* Stack vertically for overall alignment */
    align-items: center;
    gap: 30px;
    /* EXPANDED: Increased max-width for better horizontal fit of typing text */
    min-width: 300px;
    max-width: 1000px; 
  }

  .wish-content-container {
      display: flex;
      flex-direction: row; /* Image and text side-by-side on desktop */
      align-items: flex-start; /* Align content to the top */
      gap: 40px;
      max-width: 100%; /* Use 100% of the parent wish-box width */
      width: 100%;
  }

  /* *** #wishImage STYLES *** */
  #wishImage {
      /* NEW DIMENSIONS: Slightly wider/taller for a better portrait look (320x450 ratio) */
      width: 320px; 
      height: 450px; 
      /* KEY: 'cover' ensures the frame is filled with no blank space */
      object-fit: cover; 
      /* FIX: Prioritize the top of the image (the head) */
      object-position: center top; 
      border-radius: 15px;
      /* ENHANCED BORDER/SHADOW */
      border: 7px solid white; 
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
      flex-shrink: 0; 
      background-color: transparent;
      
      /* NEW ANIMATION FOR A NICER APPEARANCE */
      transform: scale(0.8);
      opacity: 0;
      animation: photo-pop 1s ease-out forwards;
      animation-delay: 0.5s; /* Delay it slightly after the page appears */
  }

  /* Animation keyframes for the photo pop */
  @keyframes photo-pop {
    0% { transform: scale(0.5); opacity: 0; }
    80% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
  }

  @media (max-width: 768px) {
      .wish-content-container {
          flex-direction: column; /* Stack vertically on mobile */
          align-items: center;
      }
      #wishImage {
          width: 80%; /* Make image full width of wish-box on mobile */
          height: auto;
          max-height: 300px;
          /* MOBILE FIX: Also ensure the top is visible on small screens */
          object-position: center top; 
      }
  }
  /* *** END OF #wishImage STYLES *** */


  #typingQuote {
    /* FIX: Removed min-height to allow the box to grow with the typed text */
    font-size: 2em;
    margin-bottom: 0; 
    border-right: 2px solid white; 
    white-space: pre-wrap; 
    overflow: hidden; 
    animation: blink-cursor 0.75s step-end infinite;
    text-align: left; 
    flex-grow: 1; 
  }
  
  @media (max-width: 600px) {
    #typingQuote {
      font-size: 1.5em;
      text-align: center; 
      /* FIX: Removed min-height for mobile responsiveness */
    }
    .wish-box {
      padding: 30px;
    }
  }

  @keyframes blink-cursor {
    from, to { border-right-color: transparent }
    50% { border-right-color: white; }
  }

  /* --- UPDATED SIGNATURE STYLE WITH 3D AND ANIMATION --- */
  #signature {
    margin-top: 20px;
    font-size: 2.2em; 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-weight: 700; 
    letter-spacing: 2px;
    color: #ffcc00; 
    
    /* 3D and Glow Properties */
    transform-style: preserve-3d;
    transition: all 0.5s ease-in-out;
    text-shadow: 
      0 0 10px rgba(255, 0, 119, 0.8), 
      0 0 20px #ffcc00, 
      0 0 30px #ffcc00;

    /* Apply continuous animations */
    animation: signature3D 4s ease-in-out infinite alternate, neonPulse 1.5s ease-in-out infinite alternate;
  }
  /* ------------------------------- */

  /* 3D Rotation Keyframes (Subtle head-turn effect) */
  @keyframes signature3D {
    0% { 
      transform: rotateY(0deg) scale(1) translateZ(0px); 
    }
    50% { 
      transform: rotateY(5deg) scale(1.02) translateZ(5px); 
    }
    100% { 
      transform: rotateY(-5deg) scale(1) translateZ(0px); 
    }
  }

  /* Neon Pulsing Keyframes (Color change pulse) */
  @keyframes neonPulse {
    from { 
      color: #ffcc00; 
      text-shadow: 
        0 0 8px rgba(255, 0, 119, 0.7),
        0 0 15px #ffcc00;
    }
    to { 
      color: #fff0b3; 
      text-shadow: 
        0 0 15px rgba(255, 0, 119, 0.9),
        0 0 30px #ffcc00, 
        0 0 40px #ffcc00;
    }
  }


  /* Heart Falling Animation (Used on Page 3) */
  .heart {
    position: absolute;
    width: 20px;
    height: 20px;
    background: #ff077a;
    transform: rotate(-45deg);
    z-index: 1;
    animation: heart-fall 10s linear infinite;
    opacity: 0.8;
  }

  .heart::before, .heart::after {
    content: "";
    position: absolute;
    width: 20px;
    height: 20px;
    background: #ff077a;
    border-radius: 50%;
  }

  .heart::before {
    top: -10px;
    left: 0;
  }

  .heart::after {
    top: 0;
    left: 10px;
  }

  @keyframes heart-fall {
    0% { top: -10%; opacity: 0; transform: translateX(0) rotate(-45deg); }
    10% { opacity: 1; }
    50% { transform: translateX(20px) rotate(-45deg); }
    100% { top: 110%; opacity: 0.2; transform: translateX(0) rotate(-45deg); }
  }
  

  /* --- WHATSAPP REPLY BUTTON STYLE --- */
  .whatsapp-reply-btn {
    display: inline-block;
    margin-top: 30px;
    padding: 15px 30px;
    background: linear-gradient(90deg, #25D366 0%, #128C7E 100%); 
    color: white;
    text-decoration: none;
    font-size: 1.4em;
    font-weight: bold;
    border-radius: 50px;
    box-shadow: 0 4px 15px rgba(37, 211, 102, 0.7);
    transition: all 0.3s ease;
    z-index: 10; 
  }

  .whatsapp-reply-btn:hover {
    background: linear-gradient(90deg, #128C7E 0%, #25D366 100%);
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(37, 211, 102, 1);
  }

  /* --- UPDATED SOCIAL MEDIA LINKS STYLE --- */
  .social-links {
    margin-top: 20px;
    display: flex;
    gap: 30px; 
    z-index: 10;
  }

  .social-icon {
    width: 40px;
    height: 40px;
    color: white; 
    /* NEW: Dark background for high contrast */
    background: rgba(0, 0, 0, 0.4); 
    /* NEW: Initial subtle shadow */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5); 
    transition: all 0.3s ease; 
    border-radius: 50%;
    /* Increased padding makes the circle larger and the SVG smaller relative to the circle */
    padding: 10px; 
    box-sizing: content-box; 
    flex-shrink: 0;
  }
  
  .social-icon svg {
    width: 100%;
    height: 100%;
    display: block; 
  }

  .social-icon:hover {
    transform: translateY(-5px) scale(1.15); /* Slightly bigger pop on hover */
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.9); /* Stronger shadow on hover */
    /* Note: filter: drop-shadow was removed as box-shadow is better for this effect */
  }

  /* --- CORRECTED INSTAGRAM STYLE --- */
  .social-icon.instagram {
      /* NEW: Default icon color is a light pink/purple to pop against the dark badge */
      color: #F0A5D4; 
      /* Ensure smooth transition for color change */
      transition: color 0.3s ease, background 0.3s ease, transform 0.3s ease;
  }
  
  /* LinkedIn Fix - Ensure icon fill color is blue by default */
  .social-icon.linkedin {
      /* Sets the SVG fill color to LinkedIn Blue by default for clarity against the dark badge */
      color: #0A66C2; 
      /* Ensure smooth transition for color change */
      transition: color 0.3s ease, background 0.3s ease, transform 0.3s ease;
  }
  
  /* Specific Hover Colors for Branding (Background changes for clarity) */
  .social-icon.instagram:hover {
    /* Instagram Gradient */
    background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
    box-shadow: 0 8px 15px rgba(225, 48, 108, 0.8);
    /* NEW: Ensure the icon itself is white on the bright gradient background */
    color: white; 
  }

  .social-icon.linkedin:hover {
    color: white; /* Change the icon (SVG) color to white on hover for high contrast */
    background-color: #0A66C2; /* LinkedIn Blue background */
    box-shadow: 0 8px 15px rgba(10, 102, 194, 0.8);
  }

  .social-icon.github:hover {
    color: white; 
    background-color: #6e5494; /* GitHub Purple/Dark */
    box-shadow: 0 8px 15px rgba(110, 84, 148, 0.8);
  }
</style>
</head>
<body onload="startIntroHeartAnimation()"> 
<div id="intro">
  <div id="intro-content">
    <h2>Hey Afifa, one surprise is there for you...</h2>
    <p>I know life gets busy, but some things—like celebrating you—just can't wait.</p>
    <p>Take a moment, relax, and let this little digital gift remind you how much you mean to me.</p>
    <p>Enjoy the memories and the music!</p>
  </div>
  <button id="startBtn">Click me for surprise 🎉<div class="confetti" id="confetti"></div></button>
</div>

<div id="mainContent">
  <h1 class="animated-text">Happy Birthday, Dear Afifa! 🎉</h1>
  
  <div class="timer-controls">
    <p>Music Timer: <span id="currentTime">0:00</span> / <span id="durationTime">0:00</span></p>
    <p>Sit back and enjoy the music and the memories...</p>
  </div>

  <div class="carousel" id="carousel"></div>
  <audio id="birthdayMusic" src="bholi se surat.mpeg" preload="auto"></audio>
</div>

<div id="finalWish">
  <div class="wish-box">
    <div class="wish-content-container">
        <img id="wishImage" src="" alt="A special birthday photo." style="display:none;"/>
        <div id="typingQuote"></div>
    </div>
    
    <div class="social-links">
        <a href="https://www.instagram.com" target="_blank" class="social-icon instagram" title="Instagram">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="20" height="20" x="2" y="2" rx="5" ry="5"/>
                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
                <line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/>
            </svg>
        </a>
        <a href="https://www.linkedin.com" target="_blank" class="social-icon linkedin" title="LinkedIn">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.1 0H4.9C2.24 0 0 2.24 0 4.9v14.2C0 21.76 2.24 24 4.9 24h14.2c2.66 0 4.9-2.24 4.9-4.9V4.9C24 2.24 21.76 0 19.1 0zM7.22 20.47H3.6V8.92h3.62v11.55zM5.4 7.23c-1.17 0-1.88-.78-1.88-1.74 0-.98.71-1.74 1.88-1.74 1.17 0 1.88.76 1.88 1.74 0 .96-.71 1.74-1.88 1.74zM20.4 20.47h-3.62v-5.6c0-1.33-.47-2.23-1.66-2.23-1.35 0-2.14.92-2.14 2.23v5.6H9.36V8.92h3.61v1.54c.48-.96 1.72-1.74 3.1-1.74 2.76 0 4.86 1.8 4.86 5.67v6.08z"/></svg>
        </a>
        <a href="https://github.com" target="_blank" class="social-icon github" title="GitHub">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.491.996.107-.775.418-1.304.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.305-.535-1.524.118-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.046.138 3.003.404 2.292-1.552 3.3-1.23 3.3-1.23.653 1.653.242 2.871.118 3.176.766.84 1.235 1.911 1.235 3.221 0 4.59-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.798 24 17.292 24 12c0-6.627-5.373-12-12-12z"/></svg>
        </a>
    </div>
    
    <div id="signature"> - Ayush S</div>
    
    <a href="https://wa.me/?text=Hey+Ayush%2C+I+got+your+surprise%21+Thank+you%21" 
       target="_blank" 
       class="whatsapp-reply-btn" 
       id="whatsappReplyBtn">
        Reply to Ayush on WhatsApp 💬
    </a>

  </div>
</div>

<script>
  // --- Constants ---
  const photos = [
    '',
  ];
  // *** NEW CONSTANT FOR FINAL PAGE IMAGE ***
  const FINAL_WISH_IMAGE = ''; // <-- REPLACE with the filename of your final wish picture
  
  const birthdayQuote = 
    `Happy Birthday, .`;
  const TYPING_SPEED = 60; // milliseconds per character

  /* ** IMPORTANT TIMER ADJUSTMENT INSTRUCTION **
  To change the timer duration for navigation (so it moves to the next page 
  *before* or *after* the music actually ends), you can use the custom duration 
  variable below.
  
  1. Set a value in seconds for CUSTOM_NAVIGATION_DELAY.
  2. Set USE_CUSTOM_TIMER to true.
  
  If USE_CUSTOM_TIMER is false, the page will wait for the audio file to *truly* end. 
  */
  const USE_CUSTOM_TIMER = true; 
  const CUSTOM_NAVIGATION_DELAY = 49; // Delay in seconds (e.g., 49 seconds for 0:49)


  // --- DOM Elements ---
  const startBtn = document.getElementById('startBtn');
  const intro = document.getElementById('intro');
  const mainContent = document.getElementById('mainContent');
  const finalWish = document.getElementById('finalWish');
  const carousel = document.getElementById('carousel');
  const music = document.getElementById('birthdayMusic');
  const currentTimeDisplay = document.getElementById('currentTime');
  const durationTimeDisplay = document.getElementById('durationTime');
  const typingQuoteElement = document.getElementById('typingQuote');
  // *** NEW DOM Element for Image ***
  const wishImageElement = document.getElementById('wishImage');
  
  let animationFinished = false;
  let customTimerId = null; // To hold the custom timer interval


  // --- Utility Functions ---

  // Format time in MM:SS
  const formatTime = (seconds) => {
    // Ensure seconds is a number and non-negative
    if (isNaN(seconds) || seconds < 0) return '0:00'; 
    const minutes = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${minutes}:${secs.toString().padStart(2, '0')}`;
  };

  // Typewriter Effect
  const startTypingEffect = (text, element) => {
    let charIndex = 0;
    element.textContent = '';
    const interval = setInterval(() => {
      if (charIndex < text.length) {
        element.textContent += text[charIndex++];
      } else {
        clearInterval(interval);
        element.style.borderRight = 'none'; // Remove cursor after typing
      }
    }, TYPING_SPEED);
  };

  // Navigate function (called by music 'ended' or custom timer)
  const navigateToFinalWish = () => {
    if (animationFinished) return;
    animationFinished = true;

    // Clear any running timers
    if (customTimerId) {
      clearInterval(customTimerId);
    }
    
    // Ensure music is paused when navigating
    music.pause();
    
    // 1. Hide the current page (Page 2)
    mainContent.style.display = 'none';
    
    // 2. Display the final wish page (Page 3)
    // NOTE: We keep 'display: flex' for centering, but the min-height and padding 
    // in CSS now ensure scrolling is possible.
    finalWish.style.display = 'flex'; 
    
    // *** NEW: Load and display the image ***
    wishImageElement.src = FINAL_WISH_IMAGE;
    wishImageElement.style.display = 'block';

    // 3. Start the typing and heart animations
    startTypingEffect(birthdayQuote, typingQuoteElement);
    startHeartAnimationPage3();
  };

  // --- Heart Animation Logic ---

  // Heart animation for Page 1 (Intro)
  const createIntroHeart = () => {
    const heart = document.createElement('div');
    heart.classList.add('intro-heart');
    
    // Randomize position and animation delay
    const size = Math.random() * 10 + 10; // Smaller hearts for intro
    heart.style.width = `${size}px`;
    heart.style.height = `${size}px`;
    heart.style.left = `${Math.random() * 100}vw`;
    heart.style.animationDuration = `${Math.random() * 5 + 8}s`; // 8-13s fall time
    heart.style.animationDelay = `-${Math.random() * 12}s`; // Start off-screen
    
    // Adjust pseudo-elements for correct heart shape size
    const halfSize = size / 2;
    heart.style.setProperty('--heart-size', `${size}px`);
    
    // Note: The original CSS uses fixed 15px for heart shape. Dynamic sizing is complex 
    // without recalculating the pseudo-elements, so we rely on the CSS animation.
    
    intro.appendChild(heart);

    // Remove heart after it falls to prevent DOM overload
    setTimeout(() => {
      heart.remove();
    }, parseFloat(heart.style.animationDuration) * 1000 + 1000); 
  };
  
  // Start the falling hearts on the Intro page
  window.startIntroHeartAnimation = () => {
    // Generate a heart every 500ms
    // We can use a loop instead of setInterval to manage a finite, random number of hearts
    for (let i = 0; i < 30; i++) {
        setTimeout(createIntroHeart, i * 1000); // Stagger initial heart creation
    }
    // Then use an interval for continuous generation
    setInterval(createIntroHeart, 1500); 
  };


  // Heart animation for Page 3 (Final Wish)
  const createFinalWishHeart = () => {
    const heart = document.createElement('div');
    heart.classList.add('heart');
    
    // Randomize position and animation delay
    const size = Math.random() * 20 + 10; 
    heart.style.width = `${size}px`;
    heart.style.height = `${size}px`;
    heart.style.left = `${Math.random() * 100}vw`;
    heart.style.animationDuration = `${Math.random() * 5 + 7}s`; // 7-12s fall time
    heart.style.animationDelay = `-${Math.random() * 10}s`; // Start off-screen for continuous feel

    finalWish.appendChild(heart);

    // Remove heart after it falls to prevent DOM overload
    setTimeout(() => {
      heart.remove();
    }, parseFloat(heart.style.animationDuration) * 1000 + 1000); 
  };
  
  const startHeartAnimationPage3 = () => {
    // Generate a heart every 500ms
    setInterval(createFinalWishHeart, 500); 
  };

  // --- Event Listeners and Main Logic ---

  // Handle the initial button click
  startBtn.addEventListener('click', () => {
    intro.style.display = 'none';
    mainContent.style.display = 'flex';
    mainContent.style.flexDirection = 'column'; // Ensure content centers vertically

    // Load photos into carousel
    photos.forEach((src, index) => {
      const div = document.createElement('div');
      div.className = 'photo';
      // Apply the correct nth-child styling based on the actual index
      div.className += ` photo:nth-child(${index + 1})`; 
      div.style.backgroundImage = `url(${src})`;
      carousel.appendChild(div);
    });

    // Play music
    music.play().catch(e => console.error("Autoplay failed:", e));

    // Confetti on click logic
    const confetti = document.getElementById('confetti');
    for(let i=0; i<24; ++i){
      const piece = document.createElement('div');
      piece.classList.add('confetti-piece');
      const angle = Math.random() * 2 * Math.PI;
      const radius = 60 + Math.random()*40;
      piece.style.setProperty('--x', `${Math.cos(angle)*radius}px`);
      piece.style.setProperty('--y', `${Math.sin(angle)*radius-42}px`);
      piece.style.background = `linear-gradient(to bottom, #${Math.floor(Math.random()*16777215).toString(16)}, #fee140)`;
      confetti.appendChild(piece);
      setTimeout(()=>{piece.remove();}, 650);
    }
  });

  // Music duration is available only after 'loadedmetadata'
  music.addEventListener('loadedmetadata', () => {
    // If using custom timer, display the custom duration, otherwise use actual duration
    if (USE_CUSTOM_TIMER) {
        durationTimeDisplay.textContent = formatTime(CUSTOM_NAVIGATION_DELAY);
    } else {
        durationTimeDisplay.textContent = formatTime(music.duration);
    }
  });

  // Update current time display every 1 second
  music.addEventListener('timeupdate', () => {
    currentTimeDisplay.textContent = formatTime(music.currentTime);
    
    // NEW LOGIC: Check if the custom cut-off time (49 seconds) has been reached
    if (USE_CUSTOM_TIMER && music.currentTime >= CUSTOM_NAVIGATION_DELAY && !animationFinished) {
        // Pause the music immediately and navigate
        music.pause();
        navigateToFinalWish();
    }
  });

  // Auto-navigate when music finishes (We rely on timeupdate for the custom cut-off, but keep this as a natural fallback)
  music.addEventListener('ended', navigateToFinalWish);


  // Integrated Hover Text Morph logic (Kept from original)
  const texts = [
    "Ready for magic? ✨",
    "Something special awaits!",
    "Don't miss this 🌟",
    "Click me for surprise 🎉"
  ];
  let t = 0;
  startBtn.addEventListener('mouseenter', () => {
    t = (t + 1) % texts.length;
    // We check for the first child node's type. If it's the text, we update it.
    if (startBtn.childNodes[0].nodeType === 3) { 
      startBtn.childNodes[0].nodeValue = "Click me for surprise "; // Reset before changing
      startBtn.childNodes[0].nodeValue = texts[t];
    }
  });
  startBtn.addEventListener('mouseleave', () => {
    if (startBtn.childNodes[0].nodeType === 3) {
      startBtn.childNodes[0].nodeValue = "Click me for surprise ";
    }
  });
</script>

</body>
</html>